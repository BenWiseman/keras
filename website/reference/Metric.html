<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Metric — Metric • keras</title>

<!-- favicons -->
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png" />
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png" />
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png" />
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png" />

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  <script src="../extra.js"></script>

<meta property="og:title" content="Metric — Metric" />
<meta property="og:description" content="A Metric object encapsulates metric logic and state that can be used to
track model performance during training. It is what is returned by the family
of metric functions that start with prefix metric_*." />
<meta property="og:image" content="/logo.png" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">keras</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.4.0.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/getting_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/tutorial_basic_classification.html">Basic Classification</a>
    </li>
    <li>
      <a href="../articles/tutorial_basic_text_classification.html">Text Classification</a>
    </li>
    <li>
      <a href="../articles/tutorial_basic_regression.html">Basic Regression</a>
    </li>
    <li>
      <a href="../articles/tutorial_overfit_underfit.html">Overfitting and Underfitting</a>
    </li>
    <li>
      <a href="../articles/tutorial_save_and_restore.html">Save and Restore Models</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Guides (New for TF 2.6)</li>
    <li>
      <a href="../articles/python_subclasses.html">Python Subclasses</a>
    </li>
    <li>
      <a href="../articles/guides/making_new_layers_and_models_via_subclassing.Rmd">Making New Layers and Models via Subclassing</a>
    </li>
    <li>
      <a href="../articles/guides/customizing_what_happens_in_fit.html">Customizing what happens in fit</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Using Keras</li>
    <li>
      <a href="../articles/guide_keras.html">Guide to Keras Basics</a>
    </li>
    <li>
      <a href="../articles/sequential_model.html">Sequential Model in Depth</a>
    </li>
    <li>
      <a href="../articles/functional_api.html">Functional API in Depth</a>
    </li>
    <li>
      <a href="../articles/about_keras_models.html">About Keras Models</a>
    </li>
    <li>
      <a href="../articles/about_keras_layers.html">About Keras Layers</a>
    </li>
    <li>
      <a href="../articles/training_visualization.html">Training Visualization</a>
    </li>
    <li>
      <a href="../articles/applications.html">Pre-Trained Models</a>
    </li>
    <li>
      <a href="../articles/faq.html">Frequently Asked Questions</a>
    </li>
    <li>
      <a href="../articles/why_use_keras.html">Why Use Keras?</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Advanced</li>
    <li>
      <a href="../articles/eager_guide.html">Eager Execution</a>
    </li>
    <li>
      <a href="../articles/training_callbacks.html">Training Callbacks</a>
    </li>
    <li>
      <a href="../articles/backend.html">Keras Backend</a>
    </li>
    <li>
      <a href="../articles/custom_layers.html">Custom Layers</a>
    </li>
    <li>
      <a href="../articles/custom_models.html">Custom Models</a>
    </li>
    <li>
      <a href="../articles/saving_serializing.html">Saving and serializing</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/learn.html">Learn</a>
</li>
<li>
  <a href="../articles/tools.html">Tools</a>
</li>
<li>
  <a href="../articles/examples/index.html">Examples</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/rstudio/keras/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Metric</h1>
    <small class="dont-index">Source: <a href='https://github.com/rstudio/keras/blob/master/R/metrics.R'><code>R/metrics.R</code></a></small>
    <div class="hidden name"><code>Metric.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>A <code>Metric</code> object encapsulates metric logic and state that can be used to
track model performance during training. It is what is returned by the family
of metric functions that start with prefix <code>metric_*</code>.</p>
    </div>


    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>name</th>
      <td><p>(Optional) string name of the metric instance.</p></td>
    </tr>
    <tr>
      <th>dtype</th>
      <td><p>(Optional) data type of the metric result.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A (subclassed) <code>Metric</code> instance that can be passed directly to
<code><a href='https://generics.r-lib.org/reference/compile.html'>compile(metrics = )</a></code>, or used as a standalone object. See <code>?Metric</code> for
example usage.</p>
    <h2 class="hasAnchor" id="usage-with-compile"><a class="anchor" href="#usage-with-compile"></a>Usage with <code>compile</code></h2>

    <p><div class="r"></p><pre><span class='va'>model</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://generics.r-lib.org/reference/compile.html'>compile</a></span><span class='op'>(</span>
  optimizer <span class='op'>=</span> <span class='st'>'sgd'</span>,
  loss <span class='op'>=</span> <span class='st'>'mse'</span>,
  metrics <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>metric_SOME_METRIC</span><span class='op'>(</span><span class='op'>)</span>, <span class='fu'>metric_SOME_OTHER_METRIC</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>)</span>
</pre><p></div></p>
    <h2 class="hasAnchor" id="standalone-usage"><a class="anchor" href="#standalone-usage"></a>Standalone usage</h2>

    <p><div class="r"></p><pre><span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'>metric_SOME_METRIC</span><span class='op'>(</span><span class='op'>)</span>
<span class='kw'>for</span> <span class='op'>(</span><span class='va'>e</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>epochs</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
  <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='va'>train_steps</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>y_true</span>, <span class='va'>y_pred</span>, sample_weight <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>%&lt;-%</span> <span class='va'>...</span>
    <span class='va'>m</span><span class='op'>$</span><span class='fu'>update_state</span><span class='op'>(</span><span class='va'>y_true</span>, <span class='va'>y_pred</span>, <span class='va'>sample_weight</span><span class='op'>)</span>
  <span class='op'>}</span>
  <span class='fu'><a href='https://rdrr.io/r/base/cat.html'>cat</a></span><span class='op'>(</span><span class='st'>'Final epoch result: '</span>, <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>m</span><span class='op'>$</span><span class='fu'>result</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>, <span class='st'>"\n"</span><span class='op'>)</span>
  <span class='va'>m</span><span class='op'>$</span><span class='fu'>reset_state</span><span class='op'>(</span><span class='op'>)</span>
<span class='op'>}</span>
</pre><p></div></p>
    <h2 class="hasAnchor" id="custom-metric-subclass-"><a class="anchor" href="#custom-metric-subclass-"></a>Custom Metric (subclass)</h2>

    

<p>To be implemented by subclasses:</p><ul>
<li><p><code>initialize()</code>: All state variables should be created in this method by calling <code>self$add_weight()</code> like:</p><pre><span class='va'>self</span><span class='op'>$</span><span class='va'>var</span> <span class='op'>&lt;-</span> <span class='va'>self</span><span class='op'>$</span><span class='fu'>add_weight</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
</pre></li>
<li><p><code>update_state()</code>: Has all updates to the state variables like:</p><pre><span class='va'>self</span><span class='op'>$</span><span class='va'>var</span><span class='op'>$</span><span class='fu'>assign_add</span><span class='op'>(</span><span class='va'>...</span><span class='op'>)</span>
</pre></li>
<li><p><code>result()</code>: Computes and returns a value for the metric from the state variables.</p></li>
</ul>

<p>Example custom metric subclass:<div class="r"></p><pre><span class='fu'>metric_binary_true_positives</span><span class='op'>(</span><span class='va'>keras</span><span class='op'>$</span><span class='va'>metrics</span><span class='op'>$</span><span class='va'>Metric</span><span class='op'>)</span> <span class='op'>%py_class%</span> <span class='op'>{</span>
  <span class='va'>initialize</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>name</span> <span class='op'>=</span> <span class='st'>'binary_true_positives'</span>, <span class='va'>...</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>super</span><span class='op'>$</span><span class='fu'>initialize</span><span class='op'>(</span>name <span class='op'>=</span> <span class='va'>name</span>, <span class='va'>...</span><span class='op'>)</span>
    <span class='va'>self</span><span class='op'>$</span><span class='va'>true_positives</span> <span class='op'>&lt;-</span> <span class='va'>self</span><span class='op'>$</span><span class='fu'>add_weight</span><span class='op'>(</span>name <span class='op'>=</span> <span class='st'>'tp'</span>, initializer <span class='op'>=</span> <span class='st'>'zeros'</span><span class='op'>)</span>
  <span class='op'>}</span>

  <span class='va'>update_state</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='va'>y_true</span>, <span class='va'>y_pred</span>, <span class='va'>sample_weight</span> <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>{</span>
    <span class='va'>y_true</span> <span class='op'>&lt;-</span> <span class='fu'><a href='k_cast.html'>k_cast</a></span><span class='op'>(</span><span class='va'>y_true</span>, <span class='st'>"bool"</span><span class='op'>)</span>
    <span class='va'>y_pred</span> <span class='op'>&lt;-</span> <span class='fu'><a href='k_cast.html'>k_cast</a></span><span class='op'>(</span><span class='va'>y_pred</span>, <span class='st'>"bool"</span><span class='op'>)</span>

    <span class='va'>values</span> <span class='op'>&lt;-</span> <span class='va'>y_true</span> <span class='op'>&amp;</span> <span class='va'>y_pred</span>
    <span class='va'>values</span> <span class='op'>&lt;-</span> <span class='fu'><a href='k_cast.html'>k_cast</a></span><span class='op'>(</span><span class='va'>values</span>, <span class='va'>self</span><span class='op'>$</span><span class='va'>dtype</span><span class='op'>)</span>
    <span class='kw'>if</span> <span class='op'>(</span><span class='op'>!</span><span class='fu'><a href='https://rdrr.io/r/base/NULL.html'>is.null</a></span><span class='op'>(</span><span class='va'>sample_weight</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>{</span>
      <span class='va'>sample_weight</span> <span class='op'>&lt;-</span> <span class='fu'><a href='k_cast.html'>k_cast</a></span><span class='op'>(</span><span class='va'>sample_weight</span>, <span class='va'>self</span><span class='op'>$</span><span class='va'>dtype</span><span class='op'>)</span>
      <span class='va'>sample_weight</span> <span class='op'>&lt;-</span> <span class='va'>tf</span><span class='op'>$</span><span class='fu'>broadcast_to</span><span class='op'>(</span><span class='va'>sample_weight</span>, <span class='va'>values</span><span class='op'>$</span><span class='va'>shape</span><span class='op'>)</span>
      <span class='va'>values</span> <span class='op'>&lt;-</span> <span class='va'>values</span> <span class='op'>*</span> <span class='va'>sample_weight</span>
    <span class='op'>}</span>
    <span class='va'>self</span><span class='op'>$</span><span class='va'>true_positives</span><span class='op'>$</span><span class='fu'>assign_add</span><span class='op'>(</span><span class='va'>tf</span><span class='op'>$</span><span class='fu'>reduce_sum</span><span class='op'>(</span><span class='va'>values</span><span class='op'>)</span><span class='op'>)</span>
  <span class='op'>}</span>

  <span class='va'>result</span> <span class='op'>&lt;-</span> <span class='kw'>function</span><span class='op'>(</span><span class='op'>)</span>
    <span class='va'>self</span><span class='op'>$</span><span class='va'>true_positives</span>
<span class='op'>}</span>

<span class='va'>model</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://generics.r-lib.org/reference/compile.html'>compile</a></span><span class='op'>(</span><span class='va'>...</span>, metrics <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='fu'>metric_binary_true_positives</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</pre><p></div></p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Tomasz Kalinowski, JJ Allaire, François Chollet,  RStudio,  Google.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


